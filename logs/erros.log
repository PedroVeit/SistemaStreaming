import os
from datetime import datetime


def _log_path():
    raiz = os.path.abspath(os.path.join(os.path.dirname(__file__), os.pardir))
    pasta_logs = os.path.join(raiz, "logs")
    if not os.path.isdir(pasta_logs):
        os.makedirs(pasta_logs)
    return os.path.join(pasta_logs, "erros.log")


def log_error(message, context=None):
    """Registra um erro com data/hora e contexto em logs/erros.log."""
    try:
        caminho = _log_path()
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        linha = "%s | ERROR | %s" % (timestamp, message)
        if context is not None:
            linha += " | context=%s" % context
        with open(caminho, "a", encoding="utf-8") as f:
            f.write(linha + "\n")
    except Exception:
        # Evita quebrar o fluxo caso o log falhe
        pass